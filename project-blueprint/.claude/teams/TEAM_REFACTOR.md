# チーム定義 — リファクタリング

## 概要

大規模なコード再構成を安全に実施するチーム。段階的リファクタリング・パフォーマンス最適化を行い、リグレッションがないことをレビューとテストで保証する。

## 使い方

```text
.claude/teams/TEAM_REFACTOR.md <対象ディレクトリ or リファクタリング指示>
```

引数は省略可能。省略時はPLが対象範囲を対話的に確認する。

### 例

```text
# 対象ディレクトリ指定（推奨）
.claude/teams/TEAM_REFACTOR.md src/features/assignment/

# 指示指定
.claude/teams/TEAM_REFACTOR.md stores/の責務分離とストア間依存の解消

# 複数対象
.claude/teams/TEAM_REFACTOR.md src/features/projects/とsrc/features/assignment/のユーティリティをshared/utils/に抽出

# 引数省略
.claude/teams/TEAM_REFACTOR.md
```

## チーム構成

| 役割 | エージェント種別 | モデル | 使用スキル | 権限 |
| --- | --- | --- | --- | --- |
| **PL（リーダー）** | general-purpose | Opus | `plan` | delegate + plan承認 |
| **リファクタラー** | general-purpose | Sonnet | `refactoring`, `implementing-features` | plan必須（PLが承認） |
| **レビュアー** | general-purpose, mode: plan | Sonnet | `code-review` | plan必須（PLが承認）、ソースコード変更不可 |
| **テスター** | general-purpose | Sonnet | `e2e-testing` | テストファイルのみ変更可 |

## 各役割の責務

### PL（リーダー）

- リファクタリング対象の影響範囲を `/plan` で調査・分析する
- TaskCreateで段階的なリファクタリングステップをタスクリストに分解する
- 各ステップでテストがグリーンであることを確認する
- リファクタラーの計画を承認/却下する
- 巻き戻しが必要な場合の判断を行う
- **自分でコードを書かない**

### リファクタラー

- 割り当てられたリファクタリングステップを段階的に実施
- 使用スキル: `/refactoring`（構造変更）、`/implementing-features`（修正・補完が必要な場合）
- 各ステップで振る舞いが変わらないことを確認する
- 巻き戻し可能な単位でコミットする
- 実装完了後、PLに報告する

### レビュアー

- リファクタリングの各ステップでコードレビューを実施
- 使用スキル: `/code-review`（品質チェック）
- 振る舞いの変更がないこと（リグレッションリスク）を重点的に確認する
- パフォーマンス計測が必要な場合はPL経由でリファクタラーに依頼する
- **ソースコードは変更しない**

### テスター

- リファクタリングの各ステップ完了後にE2Eテストを実行
- 使用スキル: `/e2e-testing`
- リグレッションテストを重点的に実施する
- 既存テストの全パスを確認する
- 必要に応じて新規テストケースを追加する
- テスト結果をPLに報告する
- **テストファイルのみ作成・変更する**

## ワークフロー

```text
PL: /plan でリファクタリング対象の影響分析 → 段階的ステップに分解 → 割り当て
  |
  v（ステップごとに繰り返し）
リファクタラー: 計画作成 → PL承認 → /refactoring でステップ実施 → 完了報告
  |
  v
レビュアー: /code-review でレビュー → フィードバック
  |  （指摘がある場合はリファクタラーが修正 → 再レビュー）
  v
テスター: /e2e-testing でリグレッションテスト → 結果報告
  |
  v
PL: ステップ完了判定 → 次のステップへ or 完了
```

### 依存関係ルール

| 前提条件 | 次のステップ |
| --- | --- |
| PLの影響分析完了 | リファクタラーが最初のステップ開始 |
| リファクタラーのステップ完了 | レビュアーがレビュー開始 |
| レビュアー承認 | テスターがリグレッションテスト実行 |
| テスト全パス | PLが次ステップを割り当て |

### 段階的実行の原則

- 1ステップ = 1つの明確な構造変更（責務移動、分割、統合など）
- 各ステップ完了時にテストがグリーンであること
- ステップ間で巻き戻しが可能であること
- 共有レイヤーの変更は逐次実行（並行不可）

## 完了条件

- [ ] リファクタラー: 全ステップ完了、コミット済み
- [ ] レビュアー: 全ステップのレビュー完了、指摘解消済み
- [ ] PL: パフォーマンスへの悪影響がないことを確認（必要に応じてリファクタラーに計測を依頼）
- [ ] テスター: 全E2Eテストパス、リグレッションなし
- [ ] PL: 全ステップの整合性確認完了、依存方向ルール違反なし

## 技術スタック参照

チーム全員が`.claude/CLAUDE.md`を読み、プロジェクトの技術スタック・規約に従うこと。
